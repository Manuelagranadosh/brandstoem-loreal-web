<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Signature Scent – L'Oréal Brandstorm</title>

<!-- Fonts: UI (Poppins) + Luxury serif (Bodoni Moda) -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Bodoni+Moda:opsz,wght@6..96,400;6..96,600&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#050505;
  --surface:rgba(20,10,30,.6);
  --primary:#9b28f0;
  --glow:#c77dff;
  --text:#fff;
  --muted:#a0a0a0;
  --loreal:#ffffff;
  --didot:'Bodoni Moda', serif;
  --ui:'Poppins', sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:var(--ui);}
body{background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;}
.hidden{display:none!important;}
.glass{background:var(--surface);backdrop-filter:blur(20px);border:1px solid rgba(155,40,240,.3);border-radius:20px;box-shadow:0 10px 40px rgba(0,0,0,.5);}
.container{max-width:1200px;margin:0 auto;padding:20px 20px 40px;position:relative;z-index:2;}
.ambient{position:fixed;width:800px;height:800px;background:radial-gradient(circle,rgba(155,40,240,.12) 0%,transparent 60%);top:50%;left:50%;transform:translate(-50%,-50%);z-index:0;animation:pulse 8s infinite alternate ease-in-out;}
@keyframes pulse{0%{transform:translate(-50%,-50%) scale(1);opacity:.7}100%{transform:translate(-50%,-50%) scale(1.3);opacity:1}}

button{cursor:pointer;border:none;font-family:inherit;transition:.3s}
.btn-pri{background:linear-gradient(45deg,var(--primary),#5a0a9e);color:white;padding:15px 35px;font-size:1.05rem;font-weight:600;border-radius:30px;box-shadow:0 5px 20px rgba(155,40,240,.4);}
.btn-pri:hover{box-shadow:0 5px 30px rgba(199,125,255,.6);transform:translateY(-2px);}
.btn-sec{background:transparent;color:white;padding:15px 35px;font-size:1.05rem;border:1px solid var(--glow);border-radius:30px;}
.btn-sec:hover{background:rgba(155,40,240,.1);}
.dis{opacity:.5;pointer-events:none}

/* NAVBAR (L'Oréal vibe) */
.nav{
  position:sticky;top:0;z-index:50;
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 0;margin-bottom:18px;
  background:linear-gradient(to bottom, rgba(5,5,5,.85), rgba(5,5,5,0));
  backdrop-filter: blur(10px);
}
.brand{
  display:flex;align-items:center;gap:12px;
}
.loreal-mark{
  width:32px;height:32px;display:grid;place-items:center;
  border:1px solid rgba(255,255,255,.18);
  border-radius:10px;
  background:rgba(255,255,255,.04);
}
.brand-title{
  font-family:var(--didot);
  letter-spacing:.08em;
  text-transform:uppercase;
  font-weight:600;
  font-size:1.05rem;
}
.brand-sub{
  color:var(--muted);
  font-size:.85rem;
  margin-top:2px;
}
.nav-actions{display:flex;gap:10px;flex-wrap:wrap;}
.nav-actions button{padding:10px 18px;font-size:.95rem;border-radius:999px}
.nav-actions .btn-sec{padding:10px 18px}

/* LANDING */
#landing{display:grid;grid-template-columns:1fr 1fr;gap:60px;align-items:center;min-height:78vh;}
h1{
  font-family:var(--didot);
  font-size:3.6rem;font-weight:600;line-height:1.05;margin-bottom:15px;
  letter-spacing:.02em;
  background:linear-gradient(135deg,#fff,var(--glow));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
h2{font-size:1.35rem;font-weight:300;color:var(--muted);margin-bottom:34px;}
.cta-group{display:flex;gap:16px;margin-bottom:40px;flex-wrap:wrap;}
.how h3{color:var(--glow);margin-bottom:14px;font-family:var(--didot);letter-spacing:.04em}
.how ul{list-style:none;color:var(--muted);font-size:.95rem;}
.how li{margin-bottom:10px;display:flex;gap:10px;}
.how li::before{content:"✦";color:var(--primary);}

/* VISUAL BOTTLE */
.visual{position:relative;height:500px;display:flex;justify-content:center;align-items:center;}
.bottle{position:relative;width:140px;height:280px;display:flex;flex-direction:column;align-items:center;animation:float 6s ease-in-out infinite;}
.cap{width:40px;height:40px;background:linear-gradient(135deg,rgba(255,255,255,.8),rgba(200,200,200,.3));border-radius:5px;z-index:3;}
.neck{width:20px;height:20px;background:linear-gradient(90deg,#d4af37,#aa7c11);z-index:2;}
.body{width:140px;height:220px;background:linear-gradient(135deg,rgba(155,40,240,.4),rgba(20,10,30,.8));border-radius:20px;border:2px solid rgba(199,125,255,.4);box-shadow:inset 0 0 30px rgba(199,125,255,.2);backdrop-filter:blur(10px);z-index:1;display:flex;justify-content:center;align-items:center;}
.label{width:68px;height:68px;border:1px solid rgba(255,255,255,.25);border-radius:50%;display:flex;justify-content:center;align-items:center;letter-spacing:3px;font-family:var(--didot);text-transform:uppercase;}
.card{position:absolute;background:rgba(20,10,30,.8);border:1px solid var(--primary);padding:10px 15px;border-radius:12px;font-size:.85rem;display:flex;gap:8px;animation:floatX 5s infinite alternate;}
.c-top{top:10%;right:5%;}
.c-heart{top:45%;left:0%;animation-delay:1.5s;}
.c-base{bottom:15%;right:0%;animation-delay:3s;}
.dot{width:12px;height:12px;border-radius:50%;background:var(--glow);box-shadow:0 0 10px var(--glow);}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}
@keyframes floatX{0%{transform:translate(0,0)}100%{transform:translate(10px,-15px)}}

/* QUIZ */
#quiz-box{max-width:900px;margin:0 auto;padding:50px 30px;}
.bar{width:100%;height:4px;background:rgba(255,255,255,.1);border-radius:2px;margin-bottom:36px;overflow:hidden;}
.fill{height:100%;background:var(--glow);width:0%;transition:width .4s ease;}
.q-title{font-family:var(--didot);font-size:2rem;text-align:center;margin-bottom:26px;letter-spacing:.02em;}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:20px;margin-bottom:34px;}

.opt-card{
  background:rgba(255,255,255,.02);
  border:1px solid rgba(255,255,255,.1);
  border-radius:15px;
  overflow:hidden;
  cursor:pointer;
  transition:all .3s cubic-bezier(.25,.8,.25,1);
  display:flex;
  flex-direction:column;
  position:relative;
  user-select:none;
}
.opt-img-wrap{
  width:100%;
  height:180px;
  overflow:hidden;
  position:relative;
  background:rgba(255,255,255,.03);
}
.opt-img-wrap::after{
  content:'';
  position:absolute;bottom:0;left:0;right:0;height:40%;
  background:linear-gradient(to top, rgba(0,0,0,.85), transparent);
  pointer-events:none;
}
.opt-img{
  width:100%;height:100%;
  object-fit:cover;
  display:block;
  transition:transform .6s ease, opacity .4s ease;
  opacity:0; /* start hidden; fade in when loaded */
}
.opt-text{
  padding:15px;
  font-size:1rem;
  color:#fff;
  text-align:center;
  font-weight:500;
  background:rgba(20,10,30,.85);
  flex-grow:1;
  display:flex;
  align-items:center;
  justify-content:center;
  border-top:1px solid rgba(255,255,255,.05);
}
.opt-card:hover .opt-img{transform:scale(1.1);}
.opt-card:hover{border-color:rgba(199,125,255,.5);transform:translateY(-3px);}
.opt-card.sel{border-color:var(--glow);box-shadow:0 0 25px rgba(155,40,240,.4);transform:translateY(-5px);}
.opt-card.sel .opt-text{background:rgba(155,40,240,.28);}

/* shimmer loader while img loads */
.shimmer{
  position:absolute;inset:0;
  background:linear-gradient(90deg, rgba(255,255,255,.04), rgba(255,255,255,.10), rgba(255,255,255,.04));
  background-size:200% 100%;
  animation:sh 1.2s infinite linear;
}
@keyframes sh{0%{background-position:200% 0}100%{background-position:-200% 0}}
.img-fallback{
  position:absolute;inset:0;
  display:grid;place-items:center;
  padding:16px;
  color:rgba(255,255,255,.85);
  background:
    radial-gradient(circle at 30% 20%, rgba(155,40,240,.35), transparent 55%),
    radial-gradient(circle at 70% 60%, rgba(199,125,255,.25), transparent 55%),
    rgba(0,0,0,.25);
  text-align:center;
}
.img-fallback .big{
  font-family:var(--didot);
  letter-spacing:.08em;
  text-transform:uppercase;
  font-size:1.05rem;
}
.img-fallback .small{
  margin-top:6px;
  font-size:.85rem;
  color:rgba(255,255,255,.7);
}

.fade-in{animation:slideUpIn .5s ease forwards;}
@keyframes slideUpIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

.txt-in{width:100%;background:rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.2);color:white;padding:20px;border-radius:12px;margin-bottom:30px;font-size:1.05rem;}
.q-foot{display:flex;justify-content:space-between;align-items:center;gap:12px;}

/* LOADING & RESULTS */
#loading{text-align:center;padding:100px 20px;}
.spinner{width:60px;height:60px;margin:0 auto 30px;border:3px solid transparent;border-top-color:var(--glow);border-radius:50%;animation:sp 1s linear infinite;}
@keyframes sp{100%{transform:rotate(360deg)}}
#results{max-width:1000px;margin:0 auto;padding:50px;}
.r-head{text-align:center;margin-bottom:40px;padding-bottom:30px;border-bottom:1px solid rgba(255,255,255,.1);}
.id-badge{display:inline-block;background:rgba(155,40,240,.2);color:var(--glow);padding:5px 15px;border-radius:20px;border:1px solid var(--primary);margin-bottom:15px;}
.s-name{font-family:var(--didot);font-size:3rem;font-weight:600;text-transform:uppercase;letter-spacing:.08em;}
.r-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:40px;}
.col{background:rgba(0,0,0,.4);border:1px solid rgba(255,255,255,.1);border-radius:15px;padding:25px;text-align:center;}
.col h4{color:var(--glow);margin-bottom:15px;font-family:var(--didot);letter-spacing:.06em;text-transform:uppercase;font-weight:600;}
.col li{list-style:none;color:#ddd;line-height:1.8;}
.story{background:linear-gradient(to right, rgba(155,40,240,.1), transparent);border-left:3px solid var(--primary);padding:20px;margin-bottom:40px;font-style:italic;color:#ccc;}
.actions{display:flex;justify-content:center;gap:15px;flex-wrap:wrap;}

/* ALERT */
.alert{position:fixed;bottom:20px;right:20px;background:var(--primary);color:white;padding:15px 25px;border-radius:10px;transform:translateX(150%);transition:.4s;z-index:100;}
.alert.show{transform:translateX(0);}

@media (max-width: 900px){
  #landing{grid-template-columns:1fr;text-align:center;}
  .visual{height:420px;}
}
@media (max-width: 768px){
  .grid{grid-template-columns:1fr;}
  .r-grid{grid-template-columns:1fr;}
  .actions{flex-direction:column;}
  .opt-img-wrap{height:130px;}
}
</style>
</head>

<body>
<div class="ambient"></div>

<div class="container">

  <!-- NAV -->
  <div class="nav">
    <div class="brand">
      <div class="loreal-mark" aria-label="L'Oréal mark">
        <!-- Simple monogram (safe + lightweight) -->
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M7 4v16h10" stroke="white" stroke-width="2" stroke-linecap="round"/>
          <path d="M10 8h7" stroke="white" stroke-width="2" stroke-linecap="round"/>
          <path d="M10 12h6" stroke="white" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>
      <div>
        <div class="brand-title">L’ORÉAL</div>
        <div class="brand-sub">Signature Scent Experience</div>
      </div>
    </div>
    <div class="nav-actions">
      <button class="btn-sec" onclick="scrollHow()">How it works</button>
      <button class="btn-pri" onclick="startQuiz()">Start quiz</button>
    </div>
  </div>

  <!-- LANDING -->
  <section id="landing">
    <div>
      <h1>Your scent,<br>your identity.</h1>
      <h2>Luxury AI-crafted personalized fragrance.</h2>
      <div class="cta-group">
        <button class="btn-pri" onclick="startQuiz()">Create your scent</button>
        <button class="btn-sec" onclick="scrollHow()">How it works</button>
      </div>
      <div class="how" id="how">
        <h3>The Process</h3>
        <ul>
          <li>AI sensory & lifestyle quiz</li>
          <li>Archetype scoring engine</li>
          <li>Precision molecular blend</li>
          <li>Formula ID saved for instant reorder</li>
        </ul>
      </div>
    </div>

    <div class="visual">
      <div class="card c-top"><div class="dot"></div> Top</div>
      <div class="card c-heart"><div class="dot"></div> Heart</div>
      <div class="card c-base"><div class="dot"></div> Base</div>
      <div class="bottle">
        <div class="cap"></div>
        <div class="neck"></div>
        <div class="body"><div class="label">S S</div></div>
      </div>
    </div>
  </section>

  <!-- QUIZ -->
  <section id="quiz" class="hidden glass" style="margin-top:5vh;">
    <div id="quiz-box">
      <div class="bar"><div id="fill" class="fill"></div></div>
      <div id="q-area" class="fade-in"></div>
      <div class="q-foot">
        <button id="b-back" class="btn-sec hidden" onclick="prevQ()">Back</button>
        <button id="b-next" class="btn-pri dis" style="margin-left:auto;" onclick="nextQ()">Next</button>
      </div>
    </div>
  </section>

  <!-- LOADING -->
  <section id="loading" class="hidden glass" style="margin-top:15vh;">
    <div class="spinner"></div>
    <h2 style="color:var(--glow); font-family: var(--didot); letter-spacing:.06em;">Synthesizing your olfactory profile...</h2>
    <p style="color:var(--muted);">Mapping archetypes and balancing molecular notes.</p>
  </section>

  <!-- RESULTS -->
  <section id="results" class="hidden glass" style="margin-top:5vh;">
    <div class="r-head">
      <div id="r-id" class="id-badge"></div>
      <div id="r-name" class="s-name"></div>
      <div style="color:var(--muted); margin-top:10px;">
        Primary: <span id="r-pri" style="color:#fff;"></span> |
        Secondary: <span id="r-sec" style="color:#fff;"></span>
      </div>
    </div>
    <div class="r-grid">
      <div class="col"><h4>Top Notes</h4><ul id="r-top"></ul></div>
      <div class="col"><h4>Heart Notes</h4><ul id="r-heart"></ul></div>
      <div class="col"><h4>Base Notes</h4><ul id="r-base"></ul></div>
    </div>
    <div id="r-story" class="story"></div>
    <div id="r-ref" style="text-align:center; color:var(--muted); margin-bottom:30px;" class="hidden"></div>
    <div class="actions">
      <button class="btn-pri" onclick="msg('Order processing L\\'Oréal Lab notified!')">Reorder now</button>
      <button class="btn-sec" onclick="msg('Formula saved to your profile!')">Save formula</button>
      <button class="btn-sec" onclick="restart()">Retake test</button>
    </div>
  </section>

</div>

<div id="alert" class="alert">Action successful!</div>

<script>
/* Data */
const DB = {
  fresh: { top:["Sicilian Lemon","Bergamot","Mint","Grapefruit"], heart:["Green Tea","Marine Accord","Basil","Water Lily"], base:["White Musk","Vetiver","Light Cedar","Ambroxan"] },
  floral: { top:["Neroli","White Peach","Pink Pepper","Pear Blossom"], heart:["Jasmine","Damascus Rose","Peony","Iris"], base:["Cashmere Wood","Vanilla","Soft Amber","Sandalwood"] },
  woody: { top:["Cardamom","Smoked Bergamot","Cypress","Black Pepper"], heart:["Atlas Cedar","Sandalwood","Pine Resin","Nutmeg"], base:["Patchouli","Oakmoss","Russian Leather","Vetiver Root"] },
  oriental: { top:["Saffron","Blood Mandarin","Cinnamon","Almond"], heart:["Black Orchid","Spiced Clove","Ylang-Ylang","Dark Cocoa"], base:["Oud","Madagascar Vanilla","Ambergris","Incense"] }
};
const Pre = { fresh: "Aura", floral: "Éclat", woody: "Bois", oriental: "Mystique" };
const Suf = { fresh: "Clair", floral: "En Fleur", woody: "Noir", oriental: "Velours" };

/* Questions with images */
const Qs = [
  { q: "1. Which childhood food memory brings comfort?", opts:[
    {t:"Citrus & lemonade", p:['fresh'], img:"https://images.unsplash.com/photo-1513364776144-60967b0f800f?w=900&q=80&auto=format&fit=crop"},
    {t:"Vanilla desserts", p:['floral'], img:"https://images.unsplash.com/photo-1550617931-e17a7b70dce2?w=900&q=80&auto=format&fit=crop"},
    {t:"Warm bread & caramel", p:['woody'], img:"https://images.unsplash.com/photo-1509440159596-0249088772ff?w=900&q=80&auto=format&fit=crop"},
    {t:"Chocolate & spices", p:['oriental'], img:"https://images.unsplash.com/photo-1549007994-cb92caebd54b?w=900&q=80&auto=format&fit=crop"}
  ]},
  { q: "2. Ultimate safe place smell?", opts:[
    {t:"Ocean breeze", p:['fresh'], img:"https://images.unsplash.com/photo-1439405326854-014607f694d7?w=900&q=80&auto=format&fit=crop"},
    {t:"Blooming gardens", p:['floral'], img:"https://images.unsplash.com/photo-1490750967868-88cb44cb2754?w=900&q=80&auto=format&fit=crop"},
    {t:"Old books & leather", p:['woody'], img:"https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=900&q=80&auto=format&fit=crop"},
    {t:"Burning incense", p:['oriental'], img:"https://images.unsplash.com/photo-1605651111623-e18987ec8827?w=900&q=80&auto=format&fit=crop"}
  ]},
  { q: "3. Main vibe to project?", opts:[
    {t:"Energetic & Clean", p:['fresh'], img:"https://images.unsplash.com/photo-1512438248247-f0f1a5a8a7f0?w=900&q=80&auto=format&fit=crop"},
    {t:"Elegant & Romantic", p:['floral'], img:"https://images.unsplash.com/photo-1518621736915-f3b1c41bfd00?w=900&q=80&auto=format&fit=crop"},
    {t:"Confident", p:['woody'], img:"https://images.unsplash.com/photo-1490558113572-887711d953d6?w=900&q=80&auto=format&fit=crop"},
    {t:"Mysterious", p:['oriental'], img:"https://images.unsplash.com/photo-1534067783941-51c9c23ecefd?w=900&q=80&auto=format&fit=crop"}
  ]},
  { q: "4. When will you wear it?", opts:[
    {t:"Early mornings", p:['fresh'], img:"https://images.unsplash.com/photo-1470252649378-9c29740c9fa8?w=900&q=80&auto=format&fit=crop"},
    {t:"The office", p:['floral','woody'], img:"https://images.unsplash.com/photo-1497215728101-856f4ea42174?w=900&q=80&auto=format&fit=crop"},
    {t:"Late night dates", p:['oriental','woody'], img:"https://images.unsplash.com/photo-1517856497829-3047e3fffae1?w=900&q=80&auto=format&fit=crop"},
    {t:"Galas", p:['oriental','floral'], img:"https://images.unsplash.com/photo-1566737236500-c8ac43014a67?w=900&q=80&auto=format&fit=crop"}
  ]},
  { q: "5. Preferred intensity?", opts:[
    {t:"Soft whisper", p:['fresh'], img:"https://images.unsplash.com/photo-1610484826967-09c5720778c7?w=900&q=80&auto=format&fit=crop"},
    {t:"Medium noticeable", p:['floral'], img:"https://images.unsplash.com/photo-1515347619152-19e04cb24eb0?w=900&q=80&auto=format&fit=crop"},
    {t:"Strong trail", p:['woody'], img:"https://images.unsplash.com/photo-1595950653106-6c9ebd614d3a?w=900&q=80&auto=format&fit=crop"},
    {t:"Unforgettable", p:['oriental'], img:"https://images.unsplash.com/photo-1515688594390-b649af70d282?w=900&q=80&auto=format&fit=crop"}
  ]},
  { q: "6. Wardrobe aesthetic?", opts:[
    {t:"Minimalist tees", p:['fresh'], img:"https://images.unsplash.com/photo-1434389678369-184cbd527b11?w=900&q=80&auto=format&fit=crop"},
    {t:"Classic silk", p:['floral'], img:"https://images.unsplash.com/photo-1583391733958-65681ce29a85?w=900&q=80&auto=format&fit=crop"},
    {t:"Street leather", p:['woody'], img:"https://images.unsplash.com/photo-1520975954732-57dd22299614?w=900&q=80&auto=format&fit=crop"},
    {t:"Night glam velvet", p:['oriental'], img:"https://images.unsplash.com/photo-1565595601552-6d27cb224fba?w=900&q=80&auto=format&fit=crop"}
  ]},
  { q: "7. Dominant family?", opts:[
    {t:"Citrus / Aquatic", p:['fresh'], img:"https://images.unsplash.com/photo-1519750157634-b6d493a0f77c?w=900&q=80&auto=format&fit=crop"},
    {t:"Floral / Fruity", p:['floral'], img:"https://images.unsplash.com/photo-1460039230329-eb070fc6c90c?w=900&q=80&auto=format&fit=crop"},
    {t:"Woody / Earthy", p:['woody'], img:"https://images.unsplash.com/photo-1448375240586-882707db888b?w=900&q=80&auto=format&fit=crop"},
    {t:"Spicy / Oriental", p:['oriental'], img:"https://images.unsplash.com/photo-1596040033229-a9821ebd058d?w=900&q=80&auto=format&fit=crop"}
  ]},
  { q: "8. Disliked note (Avoid)?", neg:true, opts:[
    {t:"Sharp Citrus", p:['fresh'], img:"https://images.unsplash.com/photo-1611162616475-46b635cb6868?w=900&q=80&auto=format&fit=crop"},
    {t:"Powdery Rose", p:['floral'], img:"https://images.unsplash.com/photo-1562690868-60bbe7293e94?w=900&q=80&auto=format&fit=crop"},
    {t:"Dry Leather", p:['woody'], img:"https://images.unsplash.com/photo-1555529902-5261145633bf?w=900&q=80&auto=format&fit=crop"},
    {t:"Heavy Incense", p:['oriental'], img:"https://images.unsplash.com/photo-1608681282681-39e559388339?w=900&q=80&auto=format&fit=crop"}
  ]},
  { q: "9. Preferred climate?", opts:[
    {t:"Hot and sunny", p:['fresh'], img:"https://images.unsplash.com/photo-1504386106331-3e4e71712b38?w=900&q=80&auto=format&fit=crop"},
    {t:"Mild Spring", p:['floral'], img:"https://images.unsplash.com/photo-1490750967868-88cb44cb2754?w=900&q=80&auto=format&fit=crop"},
    {t:"Rainy and cool", p:['woody'], img:"https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?w=900&q=80&auto=format&fit=crop"},
    {t:"Freezing snow", p:['oriental'], img:"https://images.unsplash.com/photo-1478265409131-1f65c88f965c?w=900&q=80&auto=format&fit=crop"}
  ]},
  { q: "10. Social setting?", opts:[
    {t:"Working the room", p:['fresh','floral'], img:"https://images.unsplash.com/photo-1511795409834-ef04bbd61622?w=900&q=80&auto=format&fit=crop"},
    {t:"Deep 1-on-1 chats", p:['woody'], img:"https://images.unsplash.com/photo-1522202176988-66273c2fd55f?w=900&q=80&auto=format&fit=crop"},
    {t:"Observing solo", p:['woody','oriental'], img:"https://images.unsplash.com/photo-1524250502761-1ac6f2e30d43?w=900&q=80&auto=format&fit=crop"},
    {t:"Center of attention", p:['oriental'], img:"https://images.unsplash.com/photo-1504593811423-6dd665756598?w=900&q=80&auto=format&fit=crop"}
  ]},
  { q: "11. (Optional) Current perfume?", txt:true }
];

let step = 0;
let ans = [];
let refPerfume = "";
let finalRes = {};

function scrollHow(){
  document.getElementById('how').scrollIntoView({behavior:'smooth'});
}

function startQuiz(){
  document.getElementById('landing').classList.add('hidden');
  document.getElementById('quiz').classList.remove('hidden');
  renderQ();
}

/* Builds the option card with shimmer + fallback if image fails */
function optCardHTML(o, i, selClass){
  // data-note used for fallback label; no HTML injection risk here because options are hardcoded
  return `
    <div class="opt-card ${selClass}" role="button" tabindex="0"
         onclick="pick(${i})"
         onkeydown="if(event.key==='Enter'||event.key===' ') pick(${i})">
      <div class="opt-img-wrap">
        <div class="shimmer" id="sh-${step}-${i}"></div>
        <img src="${o.img}" class="opt-img" alt=""
             loading="lazy"
             onload="imgOk(this, 'sh-${step}-${i}')"
             onerror="imgFail(this, 'sh-${step}-${i}', '${escapeAttr(o.t)}')">
      </div>
      <div class="opt-text">${o.t}</div>
    </div>
  `;
}

function renderQ(){
  const qArea = document.getElementById('q-area');
  qArea.classList.remove('fade-in');
  void qArea.offsetWidth;
  qArea.classList.add('fade-in');

  const q = Qs[step];
  document.getElementById('fill').style.width = ((step / Qs.length) * 100) + '%';
  document.getElementById('b-back').classList.toggle('hidden', step === 0);

  let html = `<h2 class="q-title">${q.q}</h2>`;
  const btnNext = document.getElementById('b-next');

  if(q.txt){
    html += `<input type="text" id="t-ans" class="txt-in" placeholder="e.g. YSL Libre, Chanel No. 5"
              value="${escapeHtml(refPerfume)}" oninput="chkTxt()">`;
    btnNext.classList.remove('dis');
    btnNext.innerText = "Finish & Analyze";
  }else{
    html += `<div class="grid" id="opts-grid">`;
    q.opts.forEach((o, i)=>{
      const sel = (ans[step] === i) ? 'sel' : '';
      html += optCardHTML(o, i, sel);
    });
    html += `</div>`;

    if(ans[step] !== undefined) btnNext.classList.remove('dis');
    else btnNext.classList.add('dis');

    btnNext.innerText = "Next";
  }

  qArea.innerHTML = html;
}

function pick(i){
  ans[step] = i;
  const grid = document.getElementById('opts-grid');
  if(grid){
    const cards = grid.children;
    for(let j=0;j<cards.length;j++){
      if(j===i) cards[j].classList.add('sel');
      else cards[j].classList.remove('sel');
    }
  }
  document.getElementById('b-next').classList.remove('dis');
}

function chkTxt(){
  const el = document.getElementById('t-ans');
  refPerfume = el ? el.value : "";
}

function nextQ(){
  if(document.getElementById('b-next').classList.contains('dis')) return;

  if(Qs[step].txt){
    const el = document.getElementById('t-ans');
    refPerfume = el ? el.value : "";
  }

  if(step < Qs.length - 1){
    step++;
    renderQ();
  }else{
    calc();
  }
}

function prevQ(){
  if(step > 0){
    step--;
    renderQ();
  }
}

function calc(){
  const pts = { fresh:0, floral:0, woody:0, oriental:0 };

  Qs.forEach((q,i)=>{
    if(!q.txt && ans[i] !== undefined){
      const pArr = q.opts[ans[i]].p;
      pArr.forEach(p => { q.neg ? pts[p] -= 2 : pts[p] += 1; });
    }
  });

  const sorted = Object.keys(pts).sort((a,b)=>pts[b]-pts[a]);
  const p1 = sorted[0];
  let p2 = sorted[1];
  if(p1 === p2) p2 = sorted[2];

  finalRes = {
    id: "SS-" + Math.floor(100000 + Math.random()*900000),
    name: `Signature ${Pre[p1]} · ${Suf[p2]}`,
    p1, p2,
    notes:{
      top:[...getRand(DB[p1].top,2), ...getRand(DB[p2].top,1)],
      heart:[...getRand(DB[p1].heart,2), ...getRand(DB[p2].heart,1)],
      base:[...getRand(DB[p1].base,2), ...getRand(DB[p2].base,1)]
    }
  };

  document.getElementById('quiz').classList.add('hidden');
  document.getElementById('loading').classList.remove('hidden');
  setTimeout(showRes, 2600);
}

function getRand(arr,n){
  const res=[]; const temp=[...arr];
  while(n-- && temp.length>0){
    res.push(temp.splice(Math.floor(Math.random()*temp.length),1)[0]);
  }
  return res;
}

function showRes(){
  document.getElementById('loading').classList.add('hidden');
  document.getElementById('results').classList.remove('hidden');

  document.getElementById('r-id').innerText = finalRes.id;
  document.getElementById('r-name').innerText = finalRes.name;
  document.getElementById('r-pri').innerText = finalRes.p1.toUpperCase();
  document.getElementById('r-sec').innerText = finalRes.p2.toUpperCase();

  document.getElementById('r-top').innerHTML = finalRes.notes.top.map(n=>`<li>${n}</li>`).join('');
  document.getElementById('r-heart').innerHTML = finalRes.notes.heart.map(n=>`<li>${n}</li>`).join('');
  document.getElementById('r-base').innerHTML = finalRes.notes.base.map(n=>`<li>${n}</li>`).join('');

  document.getElementById('r-story').innerText =
    `A precise formulation driven by a ${finalRes.p1} soul. Opens with ${finalRes.notes.top[0]}, settling into a heart anchored by ${finalRes.notes.heart[0]}. The ${finalRes.p2} sub-profile rests on a timeless base of ${finalRes.notes.base[0]}.`;

  const refDiv = document.getElementById('r-ref');
  if(refPerfume && refPerfume.trim().length){
    refDiv.classList.remove('hidden');
    refDiv.innerHTML = `Reference: <strong>${escapeHtml(refPerfume)}</strong>`;
  }else{
    refDiv.classList.add('hidden');
    refDiv.innerHTML = '';
  }

  window.scrollTo(0,0);
}

function msg(txt){
  const b = document.getElementById('alert');
  b.innerText = txt;
  b.classList.add('show');
  setTimeout(()=>b.classList.remove('show'), 3000);
}

function restart(){
  step = 0;
  ans = [];
  refPerfume = "";
  finalRes = {};

  document.getElementById('results').classList.add('hidden');
  document.getElementById('loading').classList.add('hidden');
  document.getElementById('quiz').classList.add('hidden');
  document.getElementById('landing').classList.remove('hidden');

  document.getElementById('fill').style.width = '0%';
  const btnNext = document.getElementById('b-next');
  btnNext.classList.add('dis');
  btnNext.innerText = 'Next';
  document.getElementById('b-back').classList.add('hidden');
  document.getElementById('q-area').innerHTML = '';
}

/* Image handlers */
function imgOk(imgEl, shimmerId){
  const sh = document.getElementById(shimmerId);
  if(sh) sh.remove();
  imgEl.style.opacity = '1';
}
function imgFail(imgEl, shimmerId, label){
  const sh = document.getElementById(shimmerId);
  if(sh) sh.remove();
  const wrap = imgEl.parentElement;
  imgEl.remove();

  const fb = document.createElement('div');
  fb.className = 'img-fallback';
  fb.innerHTML = `
    <div>
      <div class="big">Signature Scent</div>
      <div class="small">${escapeHtml(label)}</div>
    </div>
  `;
  wrap.appendChild(fb);
}

/* Escapes */
function escapeHtml(str){
  return String(str ?? "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
function escapeAttr(str){
  // for putting inside single quotes in an inline handler
  return String(str ?? "").replaceAll("\\", "\\\\").replaceAll("'", "\\'");
}
</script>

</body>
</html>